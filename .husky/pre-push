#!/usr/bin/env bash
set -euo pipefail

if [[ "${SKIP_PREPUSH:-}" == "1" ]]; then
	echo "[pre-push] Skipped via SKIP_PREPUSH=1"
	exit 0
fi

echo "[pre-push] Node $(node -v)"
echo "[1/3] Prettier format check (scoped)" 
npx prettier --check "server/**/*.ts" "client/src/**/*.tsx" "tests/**/*.ts" || {
	echo "[pre-push] Formatting issues found. Run: npm run format"; exit 1; }

echo "[2/3] ESLint (lightweight scope, strict, cache)"
npx eslint server client/src tests --ext .ts,.tsx --cache --cache-location .eslintcache --max-warnings=0 || {
	echo "[pre-push] ESLint failed"; exit 1; }

echo "[3/3] TypeScript type check (fast noEmit)"
npx tsc --noEmit --pretty false || { echo "[pre-push] Type errors"; exit 1; }

echo "[pre-push] All checks passed."

